@page "/"
@using MathEditor.Components
@using MathEditor.Models
@using MathEditor.Services

@inject IJSRuntime JS
@inject EditorState Editor;

<div class="canvas-container" tabindex="0"
     @onpointerdown="OnPointerDown"
     @onpointermove="OnPointerMove"
     @onpointerup="OnPointerUp"
     @onwheel:preventDefault
     @onwheel="OnWheel"
     @onkeydown="OnKeyDown">

    <div class="grid @(Editor.Mode == EditorMode.Pan ? _panning ? "panning" : "pan" : "")"
         style="@GridStyle">
    </div>
    
    <div class="camera" style="@CameraStyle">
        @foreach (var field in Fields)
        {
            if (field is TextField tf)
            {
                <TextFieldView Field="tf"
                               Zoom="_zoom"
                               PanX="_panX"
                               PanY="_panY" 
                               OnSelect="HandleFieldSelect"
                               OnStartDrag="HandleFieldDragStart"/>
            }
        }
    </div>
    
    @if (_isSelecting || _isFadingSelection)
    {
        <div class="selection-box @(_isFadingSelection ? "fade-out" : "")"
             style="@SelectionBoxStyle">
        </div>
    }
</div>